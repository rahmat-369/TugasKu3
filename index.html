<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>TugasKu - Update Tahap 3</title>
  <meta name="app-version" content="1.1.0">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <!-- Favicon (gunakan ikon yang Anda upload) -->
  <link rel="icon" type="image/png" href="my-icon.png">
  <style>
    /* CSS Variables & Base Styles */
    :root {
      --primary: #3B82F6;
      --primary-600: #2563EB;
      --bg: #f8fafc;
      --card: #ffffff;
      --muted: #6b7280;
      --success: #10b981;
      --warning: #f59e0b;
      --danger: #ef4444;
      --glass: rgba(255,255,255,0.5);
      --radius: 14px;
      --shadow: 0 6px 18px rgba(16,24,40,0.06);
      --priority-high: #ef4444;
      --priority-medium: #f59e0b;
      --priority-low: #10b981;
      --theme-colorful-1: #8B5CF6;
      --theme-colorful-2: #EC4899;
      --theme-colorful-3: #F97316;
      --theme-colorful-gradient: linear-gradient(135deg, var(--theme-colorful-1), var(--theme-colorful-2));
      --theme-forest-1: #10b981;
      --theme-forest-2: #059669;
      --theme-forest-3: #ecfdf5;
      --theme-forest-gradient: linear-gradient(135deg, var(--theme-forest-1), var(--theme-forest-2));
      --theme-sunset-1: #f97316; /* Orange 500 */
      --theme-sunset-2: #ea580c; /* Orange 600 */
      --theme-sunset-3: #fff7ed; /* Orange 50 */
      --theme-sunset-gradient: linear-gradient(135deg, var(--theme-sunset-1), var(--theme-sunset-2));
      font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Oxygen, Ubuntu, Cantarell, sans-serif;
      -webkit-font-smoothing: antialiased;
      -moz-osx-font-smoothing: grayscale;
    }
    .dark-mode {
      --bg: #0b1220;
      --card: #0f1724;
      --muted: #cbd5e1; /* Diperbaiki untuk kontras lebih baik */
      --glass: rgba(20,25,34,0.6);
      color-scheme: dark;
      color: #e6eef8; /* Diperbaiki untuk kontras lebih baik */
    }
    .colorful-mode {
      --primary: #8B5CF6;
      --primary-600: #7C3AED;
      --bg: #fdf4ff;
      --card: #ffffff;
      --muted: #6b7280;
      --glass: rgba(255,255,255,0.7);
      --success: #10b981;
      --warning: #f59e0b;
      --danger: #ef4444;
      color: #1f2937;
    }
    .dark-mode.colorful-mode {
      --bg: #1e1b2e;
      --card: #2a2540;
      --muted: #d1d5db;
      --glass: rgba(42,37,64,0.7);
      color: #f3f4f6;
    }
    /* Forest Theme - Requirement 4 */
    .forest-mode {
      --primary: #10b981;
      --primary-600: #059669;
      --bg: #ecfdf5;
      --card: #ffffff;
      --muted: #6b7280;
      --glass: rgba(255,255,255,0.7);
      --success: #10b981;
      --warning: #f59e0b;
      --danger: #ef4444;
      color: #0f1724;
    }
    .dark-mode.forest-mode {
      --bg: #064e3b; /* Emerald 900 */
      --card: #047857; /* Emerald 700 */
      --muted: #a7f3d0; /* Emerald 200 */
      --glass: rgba(4, 120, 87, 0.7);
      color: #d1fae5; /* Emerald 100 */
    }
    /* Sunset Theme - Requirement 4 */
    .sunset-mode {
      --primary: #f97316;
      --primary-600: #ea580c;
      --bg: #fff7ed;
      --card: #ffffff;
      --muted: #6b7280;
      --glass: rgba(255,255,255,0.7);
      --success: #10b981;
      --warning: #f59e0b;
      --danger: #ef4444;
      color: #0f1724;
    }
    .dark-mode.sunset-mode {
      --bg: #7c2d12; /* Orange 900 */
      --card: #c2410c; /* Orange 700 */
      --muted: #fed7aa; /* Orange 200 */
      --glass: rgba(194, 65, 12, 0.7);
      color: #ffedd5; /* Orange 100 */
    }
    * {
      box-sizing: border-box;
      margin: 0;
      padding: 0;
    }
    html, body {
      height: 100%;
      overflow-x: hidden;
    }
    body {
      background: linear-gradient(180deg, var(--bg), #f1f5f9);
      min-height: 100vh;
      color: #0f1724;
      padding: 0;
      transition: background .25s, color .25s;
      -webkit-font-smoothing: antialiased;
      display: flex;
      flex-direction: column;
    }
    .dark-mode input,
    .dark-mode textarea,
    .dark-mode select {
      color: #e6eef8; /* Diperbaiki untuk kontras lebih baik */
      border-color: rgba(255,255,255,0.1);
      background: rgba(255,255,255,0.02); /* Ditambahkan untuk visibility */
    }
    .dark-mode.colorful-mode input,
    .dark-mode.colorful-mode textarea,
    .dark-mode.colorful-mode select,
    .dark-mode.forest-mode input,
    .dark-mode.forest-mode textarea,
    .dark-mode.forest-mode select,
    .dark-mode.sunset-mode input,
    .dark-mode.sunset-mode textarea,
    .dark-mode.sunset-mode select {
      color: #cbd5e1; /* Diperbaiki untuk visibility */
    }
    /* Container */
    .container {
      max-width: 100%;
      margin: 0 auto;
      padding: 12px;
      width: 100%;
      flex: 1;
    }
    /* Header dengan penambahan menu pengaturan */
    header {
      position: sticky;
      top: 12px;
      z-index: 40;
      margin-bottom: 18px;
      background: linear-gradient(180deg, rgba(255,255,255,0.55), rgba(255,255,255,0.40));
      backdrop-filter: blur(8px) saturate(120%);
      border-radius: 14px;
      box-shadow: var(--shadow);
      padding: 12px 16px;
      display: flex;
      align-items: center;
      justify-content: space-between;
      gap: 12px;
      border: 1px solid rgba(16,24,40,0.04);
      flex-wrap: wrap;
    }
    .dark-mode header,
    .dark-mode.colorful-mode header,
    .dark-mode.forest-mode header,
    .dark-mode.sunset-mode header {
      background: linear-gradient(180deg, rgba(255,255,255,0.04), rgba(255,255,255,0.02));
      border: 1px solid rgba(255,255,255,0.04);
    }
    .brand {
      display: flex;
      align-items: center;
      gap: 12px;
    }
    .logo {
      width: 40px;
      height: 40px;
      font-size: 20px;
      display: flex;
      align-items: center;
      justify-content: center;
      border-radius: 10px;
      background: var(--primary);
      color: #fff;
      flex-shrink: 0;
    }
    .logo .app-icon {
      width: 100%;
      height: 100%;
      object-fit: cover;
      display: block;
      border-radius: 8px;
    }
    .brand h1 {
      font-size: 20px;
      font-weight: 700;
    }
    .header-actions {
      display: flex;
      gap: 8px;
      align-items: center;
    }
    .icon-btn {
      width: 36px;
      height: 36px;
      border-radius: 999px;
      border: 1px solid rgba(0,0,0,0.04);
      background: var(--card);
      display: flex;
      align-items: center;
      justify-content: center;
      cursor: pointer;
      transition: transform 0.1s;
    }
    .dark-mode .icon-btn,
    .dark-mode.colorful-mode .icon-btn,
    .dark-mode.forest-mode .icon-btn,
    .dark-mode.sunset-mode .icon-btn {
      border-color: rgba(255,255,255,0.04);
    }
    .icon-btn:active {
      transform: scale(0.95);
    }
    /* Menu pengaturan */
    .settings-menu {
      position: absolute;
      top: 100%;
      right: 0;
      background: var(--card);
      border-radius: 12px;
      padding: 12px;
      box-shadow: 0 10px 25px rgba(0,0,0,0.15);
      min-width: 200px;
      z-index: 50;
      display: none;
      margin-top: 8px;
      border: 1px solid rgba(0,0,0,0.05);
    }
    .dark-mode .settings-menu,
    .dark-mode.colorful-mode .settings-menu,
    .dark-mode.forest-mode .settings-menu,
    .dark-mode.sunset-mode .settings-menu {
      border-color: rgba(255,255,255,0.05);
    }
    .settings-menu.show {
      display: block;
    }
    .settings-item {
      display: flex;
      align-items: center;
      gap: 10px;
      padding: 10px;
      border-radius: 8px;
      cursor: pointer;
      transition: background 0.2s;
    }
    .settings-item:hover {
      background: rgba(0,0,0,0.03);
    }
    .dark-mode .settings-item:hover,
    .dark-mode.colorful-mode .settings-item:hover,
    .dark-mode.forest-mode .settings-item:hover,
    .dark-mode.sunset-mode .settings-item:hover {
      background: rgba(255,255,255,0.05);
    }
    /* Tab Navigation */
    .tab-navigation {
      display: flex;
      background: rgba(0,0,0,0.03);
      padding: 4px;
      border-radius: 12px;
      margin-bottom: 20px;
    }
    .dark-mode .tab-navigation,
    .dark-mode.colorful-mode .tab-navigation,
    .dark-mode.forest-mode .tab-navigation,
    .dark-mode.sunset-mode .tab-navigation {
      background: rgba(255,255,255,0.05);
    }
    .tab-btn {
      flex: 1;
      padding: 10px;
      border-radius: 10px;
      border: none;
      background: transparent;
      cursor: pointer;
      font-weight: 600;
      transition: background 0.2s;
    }
    .tab-btn.active {
      background: var(--card);
      box-shadow: var(--shadow);
    }
    .tab-content {
      display: none;
    }
    .tab-content.active {
      display: block;
    }
    /* Form & Field Styles */
    .form-section {
      background: var(--card);
      border-radius: 16px;
      padding: 20px;
      box-shadow: var(--shadow);
      margin-bottom: 20px;
    }
    .controls {
      display: flex;
      gap: 10px;
    }
    .field {
      margin-bottom: 16px;
      position: relative;
    }
    .field label {
      display: block;
      margin-bottom: 6px;
      font-weight: 600;
      font-size: 14px;
    }
    .field input,
    .field textarea,
    .field select {
      width: 100%;
      padding: 12px 14px;
      border-radius: 10px;
      border: 1px solid rgba(0,0,0,0.08);
      background: var(--glass);
      font-family: inherit;
      font-size: 15px;
      outline: 0;
      transition: border-color 0.2s, box-shadow 0.2s;
    }
    .field input:focus,
    .field textarea:focus,
    .field select:focus {
      border-color: var(--primary);
      box-shadow: 0 0 0 3px rgba(59,130,246,0.2);
    }
    .colorful-mode .field input:focus,
    .colorful-mode .field textarea:focus,
    .colorful-mode .field select:focus {
      border-color: var(--theme-colorful-1);
      box-shadow: 0 0 0 3px rgba(139,92,246,0.2);
    }
    .forest-mode .field input:focus,
    .forest-mode .field textarea:focus,
    .forest-mode .field select:focus {
      border-color: var(--theme-forest-1);
      box-shadow: 0 0 0 3px rgba(16,185,129,0.2);
    }
    .sunset-mode .field input:focus,
    .sunset-mode .field textarea:focus,
    .sunset-mode .field select:focus {
      border-color: var(--theme-sunset-1);
      box-shadow: 0 0 0 3px rgba(249,115,22,0.2);
    }
    .field input:focus + label,
    .field input:not(:placeholder-shown) + label,
    .field textarea:focus + label,
    .field textarea:not(:placeholder-shown) + label,
    .field select:focus + label,
    .field select:not([value=""]):valid + label {
      color: var(--primary);
    }
    .colorful-mode .field input:focus + label,
    .colorful-mode .field input:not(:placeholder-shown) + label,
    .colorful-mode .field textarea:focus + label,
    .colorful-mode .field textarea:not(:placeholder-shown) + label,
    .colorful-mode .field select:focus + label,
    .colorful-mode .field select:not([value=""]):valid + label {
      color: var(--theme-colorful-1);
    }
    .forest-mode .field input:focus + label,
    .forest-mode .field input:not(:placeholder-shown) + label,
    .forest-mode .field textarea:focus + label,
    .forest-mode .field textarea:not(:placeholder-shown) + label,
    .forest-mode .field select:focus + label,
    .forest-mode .field select:not([value=""]):valid + label {
      color: var(--theme-forest-1);
    }
    .sunset-mode .field input:focus + label,
    .sunset-mode .field input:not(:placeholder-shown) + label,
    .sunset-mode .field textarea:focus + label,
    .sunset-mode .field textarea:not(:placeholder-shown) + label,
    .sunset-mode .field select:focus + label,
    .sunset-mode .field select:not([value=""]):valid + label {
      color: var(--theme-sunset-1);
    }
    /* Filter Section */
    .filter-section {
      display: flex;
      flex-wrap: wrap;
      gap: 8px;
      margin-bottom: 20px;
    }
    .filter-btn {
      padding: 8px 14px;
      border-radius: 999px;
      border: 1px solid rgba(0,0,0,0.08);
      background: transparent;
      font-weight: 600;
      font-size: 14px;
      cursor: pointer;
      transition: background 0.2s, color 0.2s;
    }
    .dark-mode .filter-btn,
    .dark-mode.colorful-mode .filter-btn,
    .dark-mode.forest-mode .filter-btn,
    .dark-mode.sunset-mode .filter-btn {
      border-color: rgba(255,255,255,0.08);
    }
    .filter-btn.active,
    .filter-btn:hover {
      background: var(--primary);
      color: #fff;
      border-color: var(--primary);
    }
    .colorful-mode .filter-btn.active,
    .colorful-mode .filter-btn:hover {
      background: var(--theme-colorful-1);
      border-color: var(--theme-colorful-1);
    }
    .forest-mode .filter-btn.active,
    .forest-mode .filter-btn:hover {
      background: var(--theme-forest-1);
      border-color: var(--theme-forest-1);
    }
    .sunset-mode .filter-btn.active,
    .sunset-mode .filter-btn:hover {
      background: var(--theme-sunset-1);
      border-color: var(--theme-sunset-1);
    }
    /* Task Card */
    .task-card {
      background: var(--card);
      padding: 16px;
      border-radius: 14px;
      box-shadow: var(--shadow);
      margin-bottom: 12px;
      position: relative;
      border-left: 4px solid transparent;
      transition: transform .12s, box-shadow .12s;
      position: relative;
      overflow: hidden;
    }
    .task-card:hover {
      transform: translateY(-2px);
      box-shadow: 0 8px 24px rgba(16,24,40,0.1);
    }
    .task-title {
      font-weight: 700;
      font-size: 18px;
      display: flex;
      align-items: center;
      gap: 8px;
      flex-wrap: wrap;
    }
    .task-detail {
      font-size: 14px;
      color: var(--muted);
      display: flex;
      gap: 8px;
      align-items: center;
      flex-wrap: wrap;
    }
    .task-actions {
      display: flex;
      gap: 8px;
      justify-content: flex-end;
      margin-top: 8px;
    }
    .status-pill {
      position: absolute;
      bottom: 12px;
      left: 12px;
      padding: 4px 10px;
      border-radius: 999px;
      font-weight: 700;
      font-size: 12px;
    }
    /* Priority classes */
    .priority-high { border-left-color: var(--priority-high); }
    .priority-medium { border-left-color: var(--priority-medium); }
    .priority-low { border-left-color: var(--priority-low); }
    /* Deadline color classes */
    .dl-ok { border-left-color: var(--success); }
    .dl-soon { border-left-color: var(--warning); }
    .dl-urgent { border-left-color: var(--danger); }
    .dl-overdue { border-left-color: #6b7280; opacity: 0.85; }
    /* Priority badge */
    .priority-badge {
      padding: 4px 10px;
      border-radius: 10px;
      font-size: 12px;
      font-weight: 700;
    }
    .priority-high-badge {
      background-color: var(--priority-high);
      color: white;
    }
    .priority-medium-badge {
      background-color: var(--priority-medium);
      color: white;
    }
    .priority-low-badge {
      background-color: var(--priority-low);
      color: white;
    }
    /* FAB */
    .fab {
      position: fixed;
      right: 20px;
      bottom: calc(20px + env(safe-area-inset-bottom));
      width: 60px;
      height: 60px;
      border-radius: 999px;
      background: linear-gradient(135deg, var(--primary), var(--primary-600));
      display: flex;
      align-items: center;
      justify-content: center;
      color: #fff;
      font-size: 24px;
      box-shadow: 0 18px 40px rgba(59,130,246,0.22);
      cursor: pointer;
      border: 0;
      z-index: 60;
      transition: transform 0.2s;
    }
    .colorful-mode .fab {
      background: var(--theme-colorful-gradient);
    }
    .forest-mode .fab {
      background: var(--theme-forest-gradient);
    }
    .sunset-mode .fab {
      background: var(--theme-sunset-gradient);
    }
    .fab:active {
      transform: scale(0.95);
    }
    /* Toast */
    .toast {
      position: fixed;
      left: 50%;
      transform: translateX(-50%);
      bottom: 100px;
      background: #111;
      color: #fff;
      padding: 12px 18px;
      border-radius: 10px;
      opacity: 0;
      pointer-events: none;
      transition: opacity .2s;
      z-index: 80;
      font-size: 14px;
      text-align: center;
      max-width: 80%;
    }
    .toast.show {
      opacity: 1;
      pointer-events: auto;
    }
    /* Watermark */
    .watermark {
      position: fixed;
      left: 12px;
      bottom: 12px;
      font-size: 12px;
      color: var(--muted);
      opacity: 0.28;
      pointer-events: none;
      z-index: 70;
      background: transparent;
      padding: 4px 6px;
      border-radius: 8px;
    }
    .dark-mode .watermark,
    .dark-mode.colorful-mode .watermark,
    .dark-mode.forest-mode .watermark,
    .dark-mode.sunset-mode .watermark {
      color: #cbd5e1;
      opacity: 0.18;
    }
    /* Empty State */
    .empty-state {
      text-align: center;
      padding: 40px 20px;
      color: var(--muted);
    }
    .empty-state h3 {
      margin-bottom: 8px;
    }
    /* Button Styles */
    .btn {
      background: var(--primary);
      color: #fff;
      padding: 10px 16px;
      border-radius: 10px;
      border: 0;
      font-weight: 600;
      cursor: pointer;
      font-size: 14px;
      display: inline-flex;
      align-items: center;
      justify-content: center;
      transition: transform 0.1s, box-shadow 0.1s;
    }
    .colorful-mode .btn {
      background: var(--theme-colorful-gradient);
    }
    .forest-mode .btn {
      background: var(--theme-forest-gradient);
    }
    .sunset-mode .btn {
      background: var(--theme-sunset-gradient);
    }
    .btn:active {
      transform: scale(0.98);
    }
    /* Schedule styles */
    .schedule-day {
      margin-bottom: 20px;
    }
    .schedule-header {
      font-weight: 700;
      font-size: 18px;
      margin-bottom: 12px;
      padding-bottom: 8px;
      border-bottom: 1px solid rgba(0,0,0,0.06);
    }
    .dark-mode .schedule-header,
    .dark-mode.colorful-mode .schedule-header,
    .dark-mode.forest-mode .schedule-header,
    .dark-mode.sunset-mode .schedule-header {
      border-bottom-color: rgba(255,255,255,0.06);
    }
    .schedule-item {
      background: var(--card);
      padding: 14px;
      border-radius: 10px;
      margin-bottom: 10px;
      box-shadow: var(--shadow);
      display: flex;
      justify-content: space-between;
      align-items: center;
    }
    .schedule-time {
      font-weight: 600;
      color: var(--primary);
      min-width: 80px;
    }
    .schedule-subject {
      font-weight: 600;
      flex: 1;
      margin: 0 12px;
    }
    /* About page styles */
    .about-section {
      background: var(--card);
      border-radius: 16px;
      padding: 20px;
      box-shadow: var(--shadow);
      margin-bottom: 20px;
    }
    .about-logo {
      text-align: center;
      margin-bottom: 20px;
    }
    .about-logo .logo {
      width: 80px;
      height: 80px;
      font-size: 36px;
      margin: 0 auto 16px;
      padding: 6px;
    }
    .about-logo .logo .app-icon {
      border-radius: 12px;
    }
    .feature-list {
      margin: 16px 0;
      padding-left: 20px;
    }
    .feature-list li {
      margin-bottom: 8px;
    }
    .version-info {
      text-align: center;
      margin-top: 24px;
      padding-top: 16px;
      border-top: 1px solid rgba(0,0,0,0.06);
    }
    .dark-mode .version-info,
    .dark-mode.colorful-mode .version-info,
    .dark-mode.forest-mode .version-info,
    .dark-mode.sunset-mode .version-info {
      border-top-color: rgba(255,255,255,0.06);
    }
    /* Modal styles */
    .modal-overlay {
      position: fixed;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      background: rgba(0,0,0,0.5);
      display: flex;
      align-items: center;
      justify-content: center;
      z-index: 100;
      opacity: 0;
      pointer-events: none;
      transition: opacity 0.3s;
    }
    .modal-overlay.show {
      opacity: 1;
      pointer-events: auto;
    }
    .modal {
      background: var(--card);
      border-radius: 16px;
      padding: 24px;
      max-width: 90%;
      width: 400px;
      max-height: 80%;
      overflow-y: auto;
      box-shadow: 0 20px 40px rgba(0,0,0,0.2);
    }
    .modal-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 20px;
    }
    .modal-close {
      background: none;
      border: none;
      font-size: 24px;
      cursor: pointer;
      color: var(--muted);
    }
    /* Badge for task count */
    .badge {
      position: absolute;
      top: -6px;
      right: -6px;
      min-width: 26px;
      height: 26px;
      border-radius: 999px;
      background: var(--danger);
      color: #fff;
      display: flex;
      align-items: center;
      justify-content: center;
      font-weight: 600;
      font-size: 13px;
      box-shadow: 0 4px 10px rgba(239,68,68,0.18);
    }
    /* Responsive */
    @media (max-width: 768px) {
      .header-actions {
        position: relative;
      }
      .settings-menu {
        min-width: 180px;
        right: 0;
        left: auto;
      }
      .brand h1 {
        font-size: 18px;
      }
      .logo {
        width: 36px;
        height: 36px;
      }
      .btn, .filter-btn {
        padding: 8px 12px;
        font-size: 13px;
      }
      .task-title {
        font-size: 16px;
      }
      .task-detail {
        font-size: 13px;
      }
      .fab {
        width: 56px;
        height: 56px;
        font-size: 22px;
      }
    }
    @media (max-width: 480px) {
      .brand {
        gap: 8px;
      }
      .header-actions {
        justify-content: flex-end;
        width: 100%;
        margin-top: 8px;
      }
      .controls {
        justify-content: space-between;
        width: 100%;
      }
      .filter-section {
        gap: 6px;
      }
      .filter-btn {
        padding: 8px 12px;
        font-size: 13px;
      }
      .schedule-item {
        flex-direction: column;
        align-items: flex-start;
        gap: 8px;
      }
      .schedule-time {
        min-width: auto;
      }
    }
  </style>
</head>
<body>
  <!-- Konten utama -->
  <div id="mainContent">
    <div class="container">
      <!-- Header -->
      <header>
        <div class="brand">
          <div class="logo">
            <img src="my-icon.png" alt="App Icon" class="app-icon">
          </div>
          <h1>TugasKu</h1>
        </div>
        <div class="header-actions">
          <button class="icon-btn" id="themeToggle" title="Ganti Tema">üåì</button>
          <button class="icon-btn" id="settingsBtn" title="Pengaturan">‚öôÔ∏è</button>
          <!-- Menu Pengaturan -->
          <div class="settings-menu" id="settingsMenu">
            <div class="settings-item" data-action="about">
              <span>‚ÑπÔ∏è</span> Tentang
            </div>
            <div class="settings-item" data-action="reset">
              <span>üîÑ</span> Reset Data
            </div>
          </div>
        </div>
      </header>

      <!-- Tab Navigation -->
      <div class="tab-navigation">
        <button class="tab-btn active" data-tab="tasks">Tugas</button>
        <button class="tab-btn" data-tab="schedule">Jadwal</button>
        <button class="tab-btn" data-tab="about">Tentang</button>
      </div>

      <!-- Tab Content: Tugas -->
      <div class="tab-content active" id="tasksTab">
        <section class="form-section" aria-labelledby="formTitle">
          <div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:16px;gap:12px;flex-wrap:wrap">
            <strong id="formTitle" style="font-size:18px;">Tambah Tugas</strong>
            <div class="controls">
              <button id="openFormBtn" class="btn" aria-expanded="false">‚ûï Tambah</button>
              <button id="clearAll" class="filter-btn" title="Hapus semua tugas">üóëÔ∏è Hapus Semua</button>
            </div>
          </div>
          <form id="taskForm" style="display:none" aria-hidden="true" novalidate>
            <div class="field">
              <label for="taskSubject">Mata Pelajaran</label>
              <input type="text" id="taskSubject" placeholder="e.g. Matematika" required>
            </div>
            <div class="field">
              <label for="taskName">Nama Tugas</label>
              <input type="text" id="taskName" placeholder="e.g. PR Halaman 10" required>
            </div>
            <div class="field">
              <label for="taskDeadline">Deadline</label>
              <input type="date" id="taskDeadline" required>
            </div>
            <div class="field">
              <label for="taskNotes">Catatan (Opsional)</label>
              <textarea id="taskNotes" placeholder="Catatan tambahan..."></textarea>
            </div>
            <div class="field">
              <label for="taskPriority">Prioritas</label>
              <select id="taskPriority">
                <option value="low">Rendah</option>
                <option value="medium" selected>Sedang</option>
                <option value="high">Tinggi</option>
              </select>
            </div>
            <div style="display:flex;gap:10px;justify-content:flex-end;margin-top:16px">
              <button type="submit" class="btn">üíæ Simpan</button>
              <button type="button" id="cancelForm" class="filter-btn">‚ùå Batal</button>
            </div>
          </form>
        </section>

        <div class="filter-section" role="region" aria-label="Filter tugas">
          <button class="filter-btn active" data-filter="all">Semua</button>
          <button class="filter-btn" data-filter="new">Baru</button>
          <button class="filter-btn" data-filter="active">Belum Selesai</button>
          <button class="filter-btn" data-filter="done">Selesai</button>
          <button class="filter-btn" data-filter="today">Hari Ini</button>
          <button class="filter-btn" data-filter="tomorrow">Besok</button>
          <button class="filter-btn" data-filter="week">Minggu Ini</button>
          <button class="filter-btn" data-filter="overdue">Terlambat</button>
        </div>

        <div id="taskList">
          <!-- Task cards will be rendered here -->
        </div>
      </div>

      <!-- Tab Content: Jadwal -->
      <div class="tab-content" id="scheduleTab">
        <section class="form-section" aria-labelledby="scheduleFormTitle">
          <div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:16px;gap:12px;flex-wrap:wrap">
            <strong id="scheduleFormTitle" style="font-size:18px;">Tambah Jadwal</strong>
            <div class="controls">
              <button id="addScheduleBtn" class="btn">‚ûï Tambah</button>
            </div>
          </div>
          <form id="scheduleForm" style="display:none" aria-hidden="true" novalidate>
            <div class="field">
              <label for="scheduleSubject">Mata Pelajaran</label>
              <input type="text" id="scheduleSubject" placeholder="e.g. Matematika" required>
            </div>
            <div class="field">
              <label for="scheduleDay">Hari</label>
              <select id="scheduleDay" required>
                <option value="">Pilih Hari</option>
                <option value="senin">Senin</option>
                <option value="selasa">Selasa</option>
                <option value="rabu">Rabu</option>
                <option value="kamis">Kamis</option>
                <option value="jumat">Jumat</option>
                <option value="sabtu">Sabtu</option>
              </select>
            </div>
            <div class="field">
              <label for="scheduleTime">Waktu</label>
              <input type="time" id="scheduleTime" required>
            </div>
            <div style="display:flex;gap:10px;justify-content:flex-end;margin-top:16px">
              <button type="submit" class="btn">üíæ Simpan</button>
              <button type="button" id="cancelScheduleForm" class="filter-btn">‚ùå Batal</button>
            </div>
          </form>
        </section>

        <div id="scheduleContainer">
          <!-- Schedule items will be rendered here -->
        </div>
      </div>

      <!-- Tab Content: Tentang -->
      <div class="tab-content" id="aboutTab">
        <div class="about-section">
          <div class="about-logo">
            <div class="logo">
              <img src="my-icon.png" alt="App Icon" class="app-icon">
            </div>
            <h2>TugasKu</h2>
            <p>Aplikasi Manajemen Tugas Sederhana</p>
          </div>
          
          <h3>Fitur Utama</h3>
          <ul class="feature-list">
            <li>üìù Tambah dan kelola tugas harian</li>
            <li>üìÖ Jadwal pelajaran mingguan</li>
            <li>üè∑Ô∏è Filter tugas berdasarkan status dan deadline</li>
            <li>üé® Tema terang/gelap dan warna-warni</li>
            <li>üíæ Data tersimpan di browser (localStorage)</li>
            <li>üì± Responsif untuk mobile dan desktop</li>
          </ul>
          
          <!-- Updated About content as per requirement 5 -->
          <h3 style="margin-top: 16px;">Versi: 1.1.0</h3>
          <p style="margin-top: 8px;">Tanggal Rilis: 30 Agustus 2025</p>
          <p style="margin-top: 8px;">Pengembang: Rahmat, pelajar MA kelas 11</p>
          <p style="margin-top: 8px;">Dibuat sepenuhnya menggunakan Mobile (hp)</p>
          <p style="margin-top: 8px;">üì© Kontak: <a href="mailto:rohmatulloh.3609@gmail.com" style="color: var(--primary);">rohmatulloh.3609@gmail.com</a></p>
          
          <h3 style="margin-top: 24px;">Deskripsi</h3>
          <p>TugasKu adalah aplikasi manajemen tugas sederhana yang dirancang untuk membantu siswa mengatur tugas sekolah mereka dengan mudah. Dengan antarmuka yang bersih dan fitur yang lengkap, pengguna dapat dengan cepat menambahkan, melihat, dan mengelola tugas serta jadwal pelajaran mereka.</p>
          
          <div class="version-info">
            <p>¬© 2025 TugasKu. Hak Cipta Dilindungi.</p>
          </div>
        </div>
      </div>
    </div>

    <!-- Floating Action Button -->
    <button class="fab" id="fab" title="Tambah Tugas/Jadwal">+</button>

    <!-- Toast Notification -->
    <div class="toast" id="toast"></div>

    <!-- Watermark -->
    <div class="watermark">by : Rahmat - v1.1.0</div>
  </div>

  <script>
    // Existing application code dengan penambahan fitur tahap 3
    (function(){
      // State management
      let tasks = [];
      let schedules = [];
      let currentFilter = 'all';
      let searchQuery = '';
      let currentTab = 'tasks';
      let currentTheme = localStorage.getItem('theme') || 'light';
      const STORAGE_KEYS = {
        TASKS: 'pr_tasks_v3',
        SCHEDULES: 'pr_schedules_v1',
        SETTINGS: 'pr_settings_v1'
      };

      // DOM elements
      const taskForm = document.getElementById('taskForm');
      const scheduleForm = document.getElementById('scheduleForm');
      const openFormBtn = document.getElementById('openFormBtn');
      const addScheduleBtn = document.getElementById('addScheduleBtn');
      const cancelFormBtn = document.getElementById('cancelForm');
      const cancelScheduleFormBtn = document.getElementById('cancelScheduleForm');
      const clearAllBtn = document.getElementById('clearAll');
      const taskList = document.getElementById('taskList');
      const scheduleContainer = document.getElementById('scheduleContainer');
      const filterButtons = document.querySelectorAll('.filter-btn[data-filter]');
      const tabButtons = document.querySelectorAll('.tab-btn');
      const fab = document.getElementById('fab');
      const toastEl = document.getElementById('toast');
      const themeToggle = document.getElementById('themeToggle');
      const settingsBtn = document.getElementById('settingsBtn');
      const settingsMenu = document.getElementById('settingsMenu');
      const settingsItems = document.querySelectorAll('.settings-item');

      // Initialize min date for deadline input
      function setMinDeadline() {
        const today = new Date().toISOString().split('T')[0];
        document.getElementById('taskDeadline').min = today;
      }

      // Initialize theme
      function initTheme() {
        document.body.className = currentTheme;
        // Update theme toggle button text/emoji
        if (currentTheme.includes('dark')) {
          themeToggle.textContent = '‚òÄÔ∏è';
        } else {
          themeToggle.textContent = 'üåô';
        }
      }

      // Save theme preference
      function saveTheme() {
        localStorage.setItem('theme', currentTheme);
      }

      // Toggle theme
      function toggleTheme() {
        if (currentTheme === 'light') {
          currentTheme = 'dark-mode';
        } else if (currentTheme === 'dark-mode') {
          currentTheme = 'colorful-mode';
        } else if (currentTheme === 'colorful-mode') {
          currentTheme = 'dark-mode colorful-mode';
        } else if (currentTheme === 'dark-mode colorful-mode') {
          currentTheme = 'forest-mode';
        } else if (currentTheme === 'forest-mode') {
          currentTheme = 'dark-mode forest-mode';
        } else if (currentTheme === 'dark-mode forest-mode') {
          currentTheme = 'sunset-mode';
        } else if (currentTheme === 'sunset-mode') {
          currentTheme = 'dark-mode sunset-mode';
        } else {
          currentTheme = 'light';
        }
        initTheme();
        saveTheme();
      }

      // Toggle settings menu
      function toggleSettingsMenu() {
        settingsMenu.classList.toggle('show');
      }

      // Close settings menu if clicked outside
      function closeSettingsMenu(e) {
        if (!settingsBtn.contains(e.target) && !settingsMenu.contains(e.target)) {
          settingsMenu.classList.remove('show');
        }
      }

      // Handle settings actions
      function handleSettingsAction(action) {
        switch(action) {
          case 'about':
            switchTab('about');
            settingsMenu.classList.remove('show');
            break;
          case 'reset':
            if (confirm('Apakah Anda yakin ingin mereset semua data?')) {
              localStorage.removeItem(STORAGE_KEYS.TASKS);
              localStorage.removeItem(STORAGE_KEYS.SCHEDULES);
              tasks = [];
              schedules = [];
              renderTasks();
              renderSchedules();
              updateBadge();
              showToast('Data telah direset');
            }
            settingsMenu.classList.remove('show');
            break;
        }
      }

      // Toggle task form visibility
      function toggleForm(show) {
        const isVisible = taskForm.style.display !== 'none';
        const shouldShow = typeof show === 'boolean' ? show : !isVisible;
        taskForm.style.display = shouldShow ? 'block' : 'none';
        openFormBtn.setAttribute('aria-expanded', shouldShow);
        taskForm.setAttribute('aria-hidden', !shouldShow);
        if (!shouldShow) {
          taskForm.reset();
        }
      }

      // Toggle schedule form visibility
      function toggleScheduleForm(show) {
        const isVisible = scheduleForm.style.display !== 'none';
        const shouldShow = typeof show === 'boolean' ? show : !isVisible;
        scheduleForm.style.display = shouldShow ? 'block' : 'none';
        addScheduleBtn.setAttribute('aria-expanded', shouldShow);
        scheduleForm.setAttribute('aria-hidden', !shouldShow);
        if (!shouldShow) {
          scheduleForm.reset();
        }
      }

      // Switch tabs
      function switchTab(tabName) {
        // Update tab buttons
        tabButtons.forEach(btn => {
          if (btn.dataset.tab === tabName) {
            btn.classList.add('active');
          } else {
            btn.classList.remove('active');
          }
        });

        // Update tab content
        document.querySelectorAll('.tab-content').forEach(content => {
          if (content.id === `${tabName}Tab`) {
            content.classList.add('active');
          } else {
            content.classList.remove('active');
          }
        });

        currentTab = tabName;

        // Hide FAB on about tab
        if (tabName === 'about') {
          fab.style.display = 'none';
        } else {
          fab.style.display = 'flex';
        }
      }

      // Update badge count
      function updateBadge() {
        const activeTasks = tasks.filter(task => task.status !== 'done').length;
        const badge = document.querySelector('.badge');
        if (badge) {
          badge.textContent = activeTasks;
          badge.style.display = activeTasks > 0 ? 'flex' : 'none';
        }
      }

      // Format date to human readable
      function formatDate(dateStr) {
        const date = new Date(dateStr);
        const today = new Date();
        const tomorrow = new Date(today);
        tomorrow.setDate(tomorrow.getDate() + 1);

        // Check if date is today
        if (date.getDate() === today.getDate() &&
            date.getMonth() === today.getMonth() &&
            date.getFullYear() === today.getFullYear()) {
          return 'Hari Ini';
        }

        // Check if date is tomorrow
        if (date.getDate() === tomorrow.getDate() &&
            date.getMonth() === tomorrow.getMonth() &&
            date.getFullYear() === tomorrow.getFullYear()) {
          return 'Besok';
        }

        // Format as DD/MM/YYYY
        const day = date.getDate().toString().padStart(2, '0');
        const month = (date.getMonth() + 1).toString().padStart(2, '0');
        const year = date.getFullYear();
        return `${day}/${month}/${year}`;
      }

      // Get relative time text
      function getRelativeTime(dateStr) {
        const date = new Date(dateStr);
        const now = new Date();
        const diffTime = date - now;
        const diffDays = Math.ceil(diffTime / (1000 * 60 * 60 * 24));

        if (diffDays < 0) return 'Terlambat';
        if (diffDays === 0) return 'Hari Ini';
        if (diffDays === 1) return 'Besok';
        return `${diffDays} hari lagi`;
      }

      // Check if date is today
      function isToday(dateStr) {
        const date = new Date(dateStr);
        const today = new Date();
        return date.getDate() === today.getDate() &&
               date.getMonth() === today.getMonth() &&
               date.getFullYear() === today.getFullYear();
      }

      // Check if date is tomorrow
      function isTomorrow(dateStr) {
        const date = new Date(dateStr);
        const tomorrow = new Date();
        tomorrow.setDate(tomorrow.getDate() + 1);
        return date.getDate() === tomorrow.getDate() &&
               date.getMonth() === tomorrow.getMonth() &&
               date.getFullYear() === tomorrow.getFullYear();
      }

      // Check if date is this week
      function isThisWeek(dateStr) {
        const date = new Date(dateStr);
        const today = new Date();
        const firstDayOfWeek = new Date(today.setDate(today.getDate() - today.getDay() + 1));
        const lastDayOfWeek = new Date(firstDayOfWeek);
        lastDayOfWeek.setDate(lastDayOfWeek.getDate() + 6);
        return date >= firstDayOfWeek && date <= lastDayOfWeek;
      }

      // Check if task is overdue
      function isOverdue(dateStr) {
        const date = new Date(dateStr);
        const today = new Date();
        today.setHours(0, 0, 0, 0);
        return date < today;
      }

      // Filter tasks based on current filter
      function filterTasks() {
        return tasks.filter(task => {
          switch(currentFilter) {
            case 'all':
              return true;
            case 'new':
              return task.status === 'new';
            case 'active':
              return task.status !== 'done';
            case 'done':
              return task.status === 'done';
            case 'today': {
              return isToday(task.deadline) && task.status !== 'done';
            }
            case 'tomorrow': {
              return isTomorrow(task.deadline) && task.status !== 'done';
            }
            case 'week': {
              return isThisWeek(task.deadline) && task.status !== 'done';
            }
            case 'overdue':
              return isOverdue(task.deadline) && task.status !== 'done';
            default:
              return true;
          }
        });
      }

      // Render tasks
      function renderTasks() {
        const filteredTasks = filterTasks();
        
        // Sort tasks: priority (high > medium > low) then by deadline
        filteredTasks.sort((a, b) => {
          // Priority order: high (0), medium (1), low (2)
          const priorityOrder = { high: 0, medium: 1, low: 2 };
          if (priorityOrder[a.priority] !== priorityOrder[b.priority]) {
            return priorityOrder[a.priority] - priorityOrder[b.priority];
          }
          // Then sort by deadline
          return new Date(a.deadline) - new Date(b.deadline);
        });

        if (filteredTasks.length === 0) {
          taskList.innerHTML = `
            <div class="empty-state">
              <div style="font-size:48px;margin-bottom:16px;">üìã</div>
              <h3>Tidak ada tugas</h3>
              <p>Tambahkan tugas baru untuk memulai</p>
            </div>
          `;
          updateBadge();
          return;
        }

        taskList.innerHTML = filteredTasks.map(task => {
          // Determine status text and color
          let statusText = '';
          let statusColor = '';
          switch (task.status) {
            case 'new':
              statusText = 'Baru';
              statusColor = 'var(--warning)';
              break;
            case 'opened':
              statusText = 'Dibaca';
              statusColor = 'var(--primary)';
              break;
            case 'done':
              statusText = 'Selesai';
              statusColor = 'var(--success)';
              break;
            default:
              statusText = 'Baru';
              statusColor = 'var(--warning)';
          }

          // Determine priority badge
          let priorityBadgeText = '';
          let priorityBadgeClass = '';
          switch (task.priority) {
            case 'high':
              priorityBadgeText = 'Tinggi';
              priorityBadgeClass = 'priority-high-badge';
              break;
            case 'medium':
              priorityBadgeText = 'Sedang';
              priorityBadgeClass = 'priority-medium-badge';
              break;
            case 'low':
              priorityBadgeText = 'Rendah';
              priorityBadgeClass = 'priority-low-badge';
              break;
          }

          // Determine deadline class
          let deadlineClass = '';
          if (task.status === 'done') {
            deadlineClass = 'dl-ok';
          } else if (isOverdue(task.deadline)) {
            deadlineClass = 'dl-overdue';
          } else {
            const daysDiff = Math.ceil((new Date(task.deadline) - new Date()) / (1000 * 60 * 60 * 24));
            if (daysDiff < 0) {
              deadlineClass = 'dl-overdue';
            } else if (daysDiff === 0) {
              deadlineClass = 'dl-urgent';
            } else if (daysDiff === 1) {
              deadlineClass = 'dl-soon';
            } else if (daysDiff <= 3) {
              deadlineClass = 'dl-soon';
            } else {
              deadlineClass = 'dl-ok';
            }
          }

          return `
            <div class="task-card ${deadlineClass} priority-${task.priority}" data-id="${task.id}">
              <div class="task-title">
                ${task.subject} - ${task.name}
                <span class="priority-badge ${priorityBadgeClass}">${priorityBadgeText}</span>
              </div>
              <div class="task-detail">
                <span>üìÖ ${formatDate(task.deadline)}</span>
                <span>‚è∞ ${getRelativeTime(task.deadline)}</span>
              </div>
              ${task.notes ? `<div class="task-detail">üìù ${task.notes}</div>` : ''}
              <div class="status-pill" style="background:${statusColor};color:#fff">${statusText}</div>
              <div class="task-actions">
                <button class="filter-btn" onclick="handleTaskAction('${task.id}', 'toggle')">
                  ${task.status === 'done' ? '‚Ü©Ô∏è Batal' : '‚úÖ Selesai'}
                </button>
                <button class="filter-btn" onclick="handleTaskAction('${task.id}', 'edit')">‚úèÔ∏è Edit</button>
                <button class="filter-btn" onclick="handleTaskAction('${task.id}', 'delete')">üóëÔ∏è Hapus</button>
              </div>
            </div>
          `;
        }).join('');

        updateBadge();
      }

      // Render schedules
      function renderSchedules() {
        if (schedules.length === 0) {
          scheduleContainer.innerHTML = `
            <div class="empty-state">
              <div style="font-size:48px;margin-bottom:16px;">üìÖ</div>
              <h3>Belum ada jadwal</h3>
              <p>Tambahkan jadwal pelajaran Anda</p>
            </div>
          `;
          return;
        }

        // Group schedules by day
        const days = ['senin', 'selasa', 'rabu', 'kamis', 'jumat', 'sabtu'];
        const schedulesByDay = {};
        days.forEach(day => {
          schedulesByDay[day] = schedules.filter(schedule => schedule.day === day);
        });

        // Sort schedules by time
        days.forEach(day => {
          schedulesByDay[day].sort((a, b) => {
            return a.time.localeCompare(b.time);
          });
        });

        // Render schedules by day
        scheduleContainer.innerHTML = days.map(day => {
          if (schedulesByDay[day].length === 0) return '';
          
          const dayNames = {
            'senin': 'Senin',
            'selasa': 'Selasa',
            'rabu': 'Rabu',
            'kamis': 'Kamis',
            'jumat': 'Jumat',
            'sabtu': 'Sabtu'
          };

          return `
            <div class="schedule-day">
              <div class="schedule-header">${dayNames[day]}</div>
              ${schedulesByDay[day].map(schedule => `
                <div class="schedule-item">
                  <div class="schedule-time">${schedule.time}</div>
                  <div class="schedule-subject">${schedule.subject}</div>
                  <div>
                    <button class="filter-btn" onclick="handleScheduleAction('${schedule.id}', 'edit')">‚úèÔ∏è</button>
                    <button class="filter-btn" onclick="handleScheduleAction('${schedule.id}', 'delete')">üóëÔ∏è</button>
                  </div>
                </div>
              `).join('')}
            </div>
          `;
        }).join('');
      }

      // Handle task actions (toggle, edit, delete)
      function handleTaskAction(taskId, action) {
        const taskIndex = tasks.findIndex(t => t.id == taskId);
        if (taskIndex === -1) return;

        const task = tasks[taskIndex];

        switch(action) {
          case 'toggle':
            task.status = task.status === 'done' ? 'active' : 'done';
            saveTasks();
            renderTasks();
            showToast(task.status === 'done' ? 'Tugas selesai!' : 'Tugas dibatalkan');
            break;
          case 'edit':
            document.getElementById('taskSubject').value = task.subject;
            document.getElementById('taskName').value = task.name;
            document.getElementById('taskDeadline').value = task.deadline;
            document.getElementById('taskNotes').value = task.notes || '';
            document.getElementById('taskPriority').value = task.priority || 'medium';
            tasks.splice(taskIndex, 1);
            saveTasks();
            updateBadge();
            toggleForm(true);
            window.scrollTo({ top: 0, behavior: 'smooth' });
            showToast('Edit tugas');
            break;
          case 'delete':
            if (confirm('Apakah Anda yakin ingin menghapus tugas ini?')) {
              tasks.splice(taskIndex, 1);
              saveTasks();
              renderTasks();
              updateBadge();
              showToast('Tugas dihapus');
            }
            break;
        }
      }

      // Handle schedule actions (edit, delete)
      function handleScheduleAction(scheduleId, action) {
        const scheduleIndex = schedules.findIndex(s => s.id == scheduleId);
        if (scheduleIndex === -1) return;

        const schedule = schedules[scheduleIndex];

        switch(action) {
          case 'edit':
            document.getElementById('scheduleSubject').value = schedule.subject;
            document.getElementById('scheduleDay').value = schedule.day;
            document.getElementById('scheduleTime').value = schedule.time;
            schedules.splice(scheduleIndex, 1);
            saveSchedules();
            toggleScheduleForm(true);
            document.getElementById('scheduleSubject').scrollIntoView({ behavior: 'smooth' });
            showToast('Edit jadwal');
            break;
          case 'delete':
            if (confirm('Apakah Anda yakin ingin menghapus jadwal ini?')) {
              schedules.splice(scheduleIndex, 1);
              saveSchedules();
              renderSchedules();
              showToast('Jadwal dihapus');
            }
            break;
        }
      }

      // Load tasks from localStorage
      function loadTasks() {
        try {
          const storedTasks = localStorage.getItem(STORAGE_KEYS.TASKS);
          tasks = storedTasks ? JSON.parse(storedTasks) : [];
        } catch (error) {
          console.error('Error loading tasks:', error);
          tasks = [];
          showToast('Gagal memuat tugas');
        }
        updateBadge();
        renderTasks();
      }

      // Load schedules from localStorage
      function loadSchedules() {
        try {
          const storedSchedules = localStorage.getItem(STORAGE_KEYS.SCHEDULES);
          schedules = storedSchedules ? JSON.parse(storedSchedules) : [];
        } catch (error) {
          console.error('Error loading schedules:', error);
          schedules = [];
          showToast('Gagal memuat jadwal');
        }
        renderSchedules();
      }

      // Save tasks to localStorage
      function saveTasks() {
        try {
          localStorage.setItem(STORAGE_KEYS.TASKS, JSON.stringify(tasks));
        } catch (error) {
          console.error('Error saving tasks:', error);
          showToast('Gagal menyimpan tugas');
        }
      }

      // Save schedules to localStorage
      function saveSchedules() {
        try {
          localStorage.setItem(STORAGE_KEYS.SCHEDULES, JSON.stringify(schedules));
        } catch (error) {
          console.error('Error saving schedules:', error);
          showToast('Gagal menyimpan jadwal');
        }
      }

      // Show toast notification
      let toastTimeout = null;
      function showToast(message, duration = 3000) {
        if (toastTimeout) {
          clearTimeout(toastTimeout);
        }
        toastEl.textContent = message;
        toastEl.classList.add('show');
        toastTimeout = setTimeout(() => {
          toastEl.classList.remove('show');
        }, duration);
      }

      // Generate unique ID
      function generateId() {
        return Date.now() + Math.floor(Math.random() * 1000);
      }

      // Initialize event listeners
      function initEventListeners() {
        // Task form submission
        taskForm.addEventListener('submit', function(e) {
          e.preventDefault();
          const subject = document.getElementById('taskSubject').value.trim();
          const name = document.getElementById('taskName').value.trim();
          const deadline = document.getElementById('taskDeadline').value; // Requirement 1: date only
          const notes = document.getElementById('taskNotes').value.trim();
          const priority = document.getElementById('taskPriority').value;

          if (!subject || !name || !deadline) {
            showToast('Harap isi semua field yang diperlukan');
            return;
          }

          const newTask = {
            id: generateId(),
            subject,
            name,
            deadline, // Requirement 1: date only
            notes,
            priority,
            status: 'new',
            createdAt: Date.now()
          };

          tasks.push(newTask);
          saveTasks();
          renderTasks();
          toggleForm(false);
          showToast('Tugas ditambahkan');
        });

        // Schedule form submission
        scheduleForm.addEventListener('submit', function(e) {
          e.preventDefault();
          const subject = document.getElementById('scheduleSubject').value.trim();
          const day = document.getElementById('scheduleDay').value;
          const time = document.getElementById('scheduleTime').value;

          if (!subject || !day || !time) {
            showToast('Harap isi semua field yang diperlukan');
            return;
          }

          const newSchedule = {
            id: generateId(),
            subject,
            day,
            time
          };

          schedules.push(newSchedule);
          saveSchedules();
          renderSchedules();
          toggleScheduleForm(false);
          showToast('Jadwal ditambahkan');
        });

        // Open task form button
        openFormBtn.addEventListener('click', () => toggleForm());

        // Add schedule button
        addScheduleBtn.addEventListener('click', () => toggleScheduleForm());

        // Cancel task form button
        cancelFormBtn.addEventListener('click', () => toggleForm(false));

        // Cancel schedule form button
        cancelScheduleFormBtn.addEventListener('click', () => toggleScheduleForm(false));

        // Clear all tasks button
        clearAllBtn.addEventListener('click', function() {
          if (tasks.length === 0) {
            showToast('Tidak ada tugas untuk dihapus');
            return;
          }
          if (confirm('Apakah Anda yakin ingin menghapus semua tugas?')) {
            tasks = [];
            saveTasks();
            renderTasks();
            updateBadge();
            showToast('Semua tugas dihapus');
          }
        });

        // Filter buttons
        filterButtons.forEach(button => {
          button.addEventListener('click', function() {
            filterButtons.forEach(btn => btn.classList.remove('active'));
            this.classList.add('active');
            currentFilter = this.dataset.filter;
            renderTasks();
          });
        });

        // Tab buttons
        tabButtons.forEach(button => {
          button.addEventListener('click', function() {
            switchTab(this.dataset.tab);
          });
        });

        // FAB button
        fab.addEventListener('click', function() {
          if (currentTab === 'tasks') {
            toggleForm(true);
            document.getElementById('taskSubject').scrollIntoView({ behavior: 'smooth' });
          } else if (currentTab === 'schedule') {
            toggleScheduleForm(true);
            document.getElementById('scheduleSubject').scrollIntoView({ behavior: 'smooth' });
          }
        });

        // Theme toggle button
        themeToggle.addEventListener('click', toggleTheme);

        // Settings button
        settingsBtn.addEventListener('click', toggleSettingsMenu);

        // Close settings menu when clicking outside
        document.addEventListener('click', closeSettingsMenu);

        // Settings menu items
        settingsItems.forEach(item => {
          item.addEventListener('click', function() {
            const action = this.dataset.action;
            handleSettingsAction(action);
          });
        });

        // Make functions globally accessible
        window.handleTaskAction = handleTaskAction;
        window.handleScheduleAction = handleScheduleAction;
        window.switchTab = switchTab;
      }

      // Initialize the app
      function init() {
        // Set version in watermark
        const versionMeta = document.querySelector('meta[name="app-version"]');
        if (versionMeta) {
          const versionText = versionMeta.getAttribute('content');
          const watermark = document.querySelector('.watermark');
          if (watermark) {
            watermark.textContent = `by : Rahmat - v${versionText}`;
          }
        }

        // Load saved theme
        const savedTheme = localStorage.getItem('theme');
        if (savedTheme) {
          currentTheme = savedTheme;
        }

        initTheme();
        setMinDeadline(); // Requirement 1
        loadTasks();
        loadSchedules();
        initEventListeners();

        // Set initial tab
        switchTab('tasks');
        showToast('Aplikasi siap digunakan', 2000);
      }

      // Start the application when DOM is loaded
      if (document.readyState === 'loading') {
        document.addEventListener('DOMContentLoaded', init);
      } else {
        init();
      }
    })();
  </script>
</body>
</html>